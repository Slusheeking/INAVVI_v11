[supervisord]
nodaemon=true
user=appuser
logfile=/app/logs/supervisord.log
logfile_maxbytes=50MB
logfile_backups=10
loglevel=info

[program:feature_engineering]
command=python -m src.feature_engineering.main
directory=/app
user=appuser
autostart=true
autorestart=true
startretries=5
startsecs=10
stopwaitsecs=30
stdout_logfile=/app/logs/feature_engineering_stdout.log
stderr_logfile=/app/logs/feature_engineering_stderr.log
stdout_logfile_maxbytes=50MB
stderr_logfile_maxbytes=50MB
stdout_logfile_backups=10
stderr_logfile_backups=10
environment=SERVICE_NAME="Feature Engineering Service"

[program:trading_strategy]
command=python -m src.trading_strategy.main
directory=/app
user=appuser
autostart=true
autorestart=true
startretries=5
startsecs=10
stopwaitsecs=30
stdout_logfile=/app/logs/trading_strategy_stdout.log
stderr_logfile=/app/logs/trading_strategy_stderr.log
stdout_logfile_maxbytes=50MB
stderr_logfile_maxbytes=50MB
stdout_logfile_backups=10
stderr_logfile_backups=10
environment=SERVICE_NAME="Trading Strategy Service"

[program:init_script]
command=/app/start.sh
directory=/app
user=appuser
autostart=true
autorestart=false
startsecs=0
priority=1
stdout_logfile=/app/logs/init_script_stdout.log
stderr_logfile=/app/logs/init_script_stderr.log
stdout_logfile_maxbytes=50MB
stderr_logfile_maxbytes=50MB
stdout_logfile_backups=10
stderr_logfile_backups=10

[eventlistener:process_monitor]
command=python -c "import sys; from supervisor import childutils; while True: childutils.listener_ready(); headers, payload = childutils.eventdata(sys.stdin.readline()); if headers['eventname'] == 'PROCESS_STATE_FATAL': print('Process entered FATAL state', flush=True); sys.exit(1); childutils.listener_ready()"
events=PROCESS_STATE_FATAL
buffer_size=1024
stdout_logfile=/app/logs/process_monitor_stdout.log
stderr_logfile=/app/logs/process_monitor_stderr.log