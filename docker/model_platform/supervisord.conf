[supervisord]
nodaemon=true
user=appuser
logfile=/app/logs/supervisord.log
logfile_maxbytes=50MB
logfile_backups=10
loglevel=info

[program:fix_matplotlib]
command=python /app/docker/model_platform/fix_matplotlib_permissions.py
directory=/app
user=appuser
autostart=true
autorestart=false
startsecs=0
priority=1
stdout_logfile=/app/logs/fix_matplotlib_stdout.log
stderr_logfile=/app/logs/fix_matplotlib_stderr.log

[program:model_training]
command=bash -c "export MPLCONFIGDIR=/tmp/matplotlib && python -m src.model_training.main"
directory=/app
user=appuser
autostart=true
autorestart=true
startretries=5
startsecs=10
stopwaitsecs=30
stdout_logfile=/app/logs/model_training_stdout.log
stderr_logfile=/app/logs/model_training_stderr.log
stdout_logfile_maxbytes=50MB
stderr_logfile_maxbytes=50MB
stdout_logfile_backups=10
stderr_logfile_backups=10
environment=SERVICE_NAME="Model Training Service"

[program:model_services]
command=bash -c "export MPLCONFIGDIR=/tmp/matplotlib && python -m src.model_services.main"
directory=/app
user=appuser
autostart=true
autorestart=true
startretries=5
startsecs=10
stopwaitsecs=30
stdout_logfile=/app/logs/model_services_stdout.log
stderr_logfile=/app/logs/model_services_stderr.log
stdout_logfile_maxbytes=50MB
stderr_logfile_maxbytes=50MB
stdout_logfile_backups=10
stderr_logfile_backups=10
environment=SERVICE_NAME="Model Services"

[program:continuous_learning]
command=bash -c "export MPLCONFIGDIR=/tmp/matplotlib && python -m src.continuous_learning.main"
directory=/app
user=appuser
autostart=true
autorestart=true
startretries=5
startsecs=10
stopwaitsecs=30
stdout_logfile=/app/logs/continuous_learning_stdout.log
stderr_logfile=/app/logs/continuous_learning_stderr.log
stdout_logfile_maxbytes=50MB
stderr_logfile_maxbytes=50MB
stdout_logfile_backups=10
stderr_logfile_backups=10
environment=SERVICE_NAME="Continuous Learning Service"

[program:init_script]
command=/app/start.sh
directory=/app
user=appuser
autostart=true
autorestart=false
startsecs=0
priority=1
stdout_logfile=/app/logs/init_script_stdout.log
stderr_logfile=/app/logs/init_script_stderr.log
stdout_logfile_maxbytes=50MB
stderr_logfile_maxbytes=50MB
stdout_logfile_backups=10
stderr_logfile_backups=10

[program:process_monitor]
command=python /app/docker/model_platform/process_monitor.py
directory=/app
user=appuser
autostart=true
autorestart=true
startretries=3
startsecs=10
stopwaitsecs=30
stdout_logfile=/app/logs/process_monitor_stdout.log
stderr_logfile=/app/logs/process_monitor_stderr.log
stdout_logfile_maxbytes=50MB
stderr_logfile_maxbytes=50MB
stdout_logfile_backups=10
stderr_logfile_backups=10
environment=PYTHONUNBUFFERED=1,MPLCONFIGDIR=/tmp/matplotlib

[include]
files = /etc/supervisor/conf.d/tf_serving_supervisord.conf